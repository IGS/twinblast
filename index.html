<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>TwinBLAST by the Institute for Genome Sciences</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>TwinBLAST</h1>
          <h2>View two BLAST reports at once</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/rileydavidr/twinblast/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/rileydavidr/twinblast/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://sourceforge.net/projects/twinblast/files/twinblast_beta.vdi/download" id="download-vdi" class="button"><span>Download .vdi</span></a>
          <a href="https://github.com/IGS/twinblast" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h2>TwinBLAST - View two BLAST reports at once</h2>

<p>TwinBLAST is a web-based tool for viewing 2 BLAST reports simultaneously
side-by-side. It uses ExtJS (<a href="http://www.sencha.com/products/extjs/">www.sencha.com/products/extjs/</a>) to provide 2
independantly scrollable panels. BioPerl (<a href="http://www.bioperl.org">www.bioperl.org</a>) is used to index
raw BLAST reports and Bio::Graphics is used to draw pictograms of the BLAST
hits.</p>

<p>Try out a demo page at <a href="http://lgt.igs.umaryland.edu/twinblast">www.lgt.igs.umaryland.edu/twinblast</a>. This page has a dataset
of <i>Drosophila mauritiana</i> lateral gene transfers loaded into it. Those results are also available 
<a href="http://lgt.igs.umaryland.edu/twinblast_mauritiana.tgz">for download</a></p>

<p>TwinBLAST uses HTML and Javascript and should work in all modern web-browsers.</p>

<h2>Instructions for the TwinBLAST Virtual Machine (VM)</h2>

<ol>
<li>Download the VM containing TwinBLAST and all of its dependencies using the link towards the top of this page.</li>
<li>Download and install VirtualBox if you do not already have it using <a href="https://www.virtualbox.org/wiki/Downloads">this link</a></li>
<li>Launch VirtualBox Manager and follow these steps:
<p>
<ol>
<li>Select "New" in the top left</li>
<li>Specify a name for the machine</li>
<li>Type: <b>Linux</b></li>
<li>Version: <b>Ubuntu (64-bit)</b></li>
<li>Click "Continue"</li>
<li>Select <b>2048 MB</b> for memory size</li>
<li>Click "Continue"</li>
<li>Select "Use an existing virtual hard disk file" (choose the VDI downloaded in step 1)</li>
<li>Click "Create"</li>
<li>Double click the machine designated by the name from <b>step 3.2</b> to start the new VM</li>
<li><b>PLEASE NOTE</b>: from this point forward, all steps will take place <i>within the VM</i> that was just booted, not in the host machine</li>
</ol>
</p>
</li>
<li>Navigate to TwinBLAST using Firefox and the URL: localhost/twinblast.html</li>
<li>This is a default TwinBLAST page that requires the following inputs to be added in order to view the example data. Please note the arrows present on the page that let one expand and shrink the various panels as they see fit. With the top panel expanded, the following data can be entered:
<p>
<ol>
<li>Blast File: SRX135546_UM_all_uniq_filtered.out (the contents of this file can be found within the VM at the path: /export/lgt/files/SRX135546_UM_all_uniq_filtered.out)</li>
<li>Query List (optional): mauritiana_ids.txt (the contents of this file can be found at the path: /export/lgt/files/mauritiana_ids.txt. This optional file aims to refine the "query List" displayed to a specific subset of the main BLAST file. If this optional input is not specified, then all the results from the BLAST file will be displayed.)</li>
<li>Left ID suffix: /1 (the chosen left ID suffix that follows each left/first query ID in the Blast File)</li>
<li>Right ID suffix: /2 (the chosen right ID suffix that follows each right/second query ID in the Blast File)</li>
</ol>
</p>
</li>
<li>Once this information has been entered into the correct input areas, clicking "Reload" towards the bottom of the top panel will then populate the data within the "Query List" panel.</li>
<li>After a dataset is loaded, either navigate to a particular ID using the "ID (prefix only)" input box under the "Analyze" header of the top panel or click on any of the IDs under the "Query List" panel.</li>
<li>Each ID can be annotated using the "Analyze" section of the top panel. The default values "yes", "no", and "maybe" can be used or a custom value can be entered into the blank textbox after clicking the adjacent button. Once the annotation has been determined, click the refresh icon towards the bottom-right of the "Query List" panel to view that the curation note has been attached to the ID.</li>
</ol>

<h4>Customization of the VM</h4>
<p>If curation is not a concern, one can place their properly formatted BLAST file (matches format of /export/lgt/files/SRX135546_UM_all_uniq_filtered.out where each pair of the two BLAST search results follows one after the other) in /export/lgt/files/ and TwinBLAST is ready for use without the need for configuring MySQL. The following sections go into detail as to how to configure Apache, MySQL, and the VM itself in order to achieve thorough customization of TwinBLAST.</p>
<h4>Apache</h4>
<ul>
<li>The main Apache configuration occurs within '/etc/apache2/apache2.conf'</li>
<li>Changing lines 73 and 165 determine where the server and CGI executables, respectively, can be found</li>
<li>Line 151 denotes that the conf file at /etc/apache2/conf.d/twinblast.conf will be used for obtaining paths to directories like where to store the BLAST image outputs</li>
<li>The environment variable CHOSEN_DB in 'twinblast.conf' needs to be changed depending on which MySQL DB is desired for use when annotating results</li>
</ul>
<h4>MySQL</h4>
<p>While MySQL is used in the default setup of TwinBLAST, it should be possible to use other databases like PostgreSQL with some modifications to the following scripts and file to convert from MySQL syntax to another database's format. Note that the .ini file needs to be changed to correspond with 'twinblast.conf' mentioned in the Apache section.</p>
<ul>
<li>/var/www/html/cgi/guiblast</li>
<li>/var/www/html/cgi/twinblastDB</li>
<li>/var/www/html/conf/curation_db.ini</li>
</ul>
<p>In order to add a new database compatible with the current set of scripts, follow these steps start in a terminal:</p>
<ol>
<li>
<p>Login to MySQL</p>
<pre><code>mysql -h localhost -u root</code></pre>
</li>
<li>
<p>Once in the MySQL prompt, first create the new custom database</p>
<pre><code>CREATE DATABASE custom_db_name</code></pre>
</li>
<li>
<p>Make sure TwinBLAST has permissions to make changes to the database</p>
<pre><code>GRANT ALL on custom_db_name.* TO 'twinblast'@'localhost';</code></pre>
</li>
<li>
<p>Switch to the new database to populate it</p>
<pre><code>use custom_db_name</code></pre>
</li>
<li>
<p>Add in the curation table that houses both the query ID and an ID to tie it to a particular curation note</p>
<pre><code>CREATE TABLE curation(seq_id VARCHAR(100), cv_id INT, PRIMARY KEY(seq_id));</code></pre>
</li>
<li>
<p>Create the table that houses the curation notes and insert the correct values into it</p>
<pre><code>CREATE TABLE cv(id INT, name VARCHAR(100), PRIMARY KEY(name));
INSERT INTO cv VALUES (1, ‘yes’);
INSERT INTO cv VALUES (2, ‘no’);
INSERT INTO cv VALUES (3, ‘maybe’);
</code></pre>
</li>
<li><p>Now leave MySQL</p></li>
<pre><code>quit</code></pre>
<li>Copy lines 1-6 in '/var/www/html/conf/curation_db.ini' and make a new set of 6 lines replacing all instances of 'mauritiana' with the 'custom_db_name' specified in the MySQL step 2</li>
<li>Modify line 10 in '/etc/apache2/conf.d/twinblast.conf' to the 'custom_db_name' specified in the MySQL step 2</li>
</ol>

<h4>Resizing the VM</h4>
<p>The most recent version of the TwinBLAST VM has about 560 MB in free space available. If more storage is required the VM can be resized using the following steps assuming that the host computer has enough space to accommodate the size increase. A walkthrough for each step necessary to increase space and then partition that space can be found <a href="http://derekmolloy.ie/resize-a-virtualbox-disk/">here</a>.
</p>

<h2>Instructions for how to build a TwinBLAST server from scratch</h2>

<p>The following packages are required in order to install and run TwinBLAST:</p>

<ul>
<li>Apache</li>
<li>ExtJS</li>
<li>MySQL</li>
</ul><p>Perl Modules:  </p>

<ul>
<li>BioPerl</li>
<li>CGI</li>
<li>Tie::File</li>
<li>File::Basename</li>
<li>Digest::MD5</li>
<li>URI::Escape</li>
<li>JSON</li>
<li>POSIX</li>
<li>Bio::Graphics</li>
<li>Config::IniFiles</li>
<li>File::Slurp</li>
</ul><h2>Installation</h2>

<ol>
<li>
<p>Download and unpack the tarball/zip file from the top of the page</p>

<pre><code>tar xzvf rileydavidr-twinblast-&lt;build&gt;.tar.gz
</code></pre>
</li>
<li>
<p>Copy the cgi directory to the cgi-bin area of your apache install  </p>

<pre><code>cd rileydavidr-twinblast-build
cp . -r www/cgi /var/www/cgi-bin/twinblast
</code></pre>
</li>
<li>
<p>Copy the html directory to the htdocs area of your apache install</p>

<pre><code>cp . -r www/html /var/www/htdocs/twinblast
</code></pre>
</li>
<li>
<p>Change the following values in /var/www/cgi-bin/twinblast/guiblast to reflect the install location</p>

<div class="highlight"><pre><span class="c1"># Root of the web site (usually htdocs or html)</span>
<span class="k">my</span> <span class="nv">$www_root</span> <span class="o">=</span> <span class="s">'/var/www/'</span><span class="p">;</span>

<span class="c1"># URL to web-accessible directory where image files are written.</span>
<span class="k">my</span> <span class="nv">$img_url</span> <span class="o">=</span> <span class="s">'/twinblast/images/'</span><span class="p">;</span>

<span class="c1"># Place where blast indexes should be written.</span>
<span class="k">my</span> <span class="nv">$idx_dir</span> <span class="o">=</span> <span class="s">'/var/www/twinblast/indexes/'</span><span class="p">;</span>

<span class="c1"># Required prefix for all files</span>
<span class="k">my</span> <span class="nv">$prefix</span> <span class="o">=</span> <span class="s">'/var/www/twinblast/files/'</span><span class="p">;</span>
</pre></div>
</li>
<li>
<p>Change the following values in /var/www/htdocs/twinblast/twinblast.js</p>

<div class="highlight"><pre><span class="nx">Ext</span><span class="p">.</span><span class="nx">onReady</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

    <span class="c1">// URL to the guiblast binary</span>
    <span class="kd">var</span> <span class="nx">GUIBLAST_URL</span> <span class="o">=</span> <span class="s1">'/cgi-bin/twinblast_test/guiblast'</span><span class="p">;</span>

</pre></div>
</li>
<li>
<p>Update the location of the extjs javascript and css files in twinblast.html</p>

<div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"/ext-4.1.1a/ext-all-debug.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"twinblast.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="c">&lt;!-- Include Ext stylesheets here: --&gt;</span>

<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/ext-4.1.1a/resources/css/ext-all.css"</span><span class="nt">&gt;</span>

</pre></div>
</li>
<li><p>Now you should be able to load blast reports into the interface using the form at the top.</p></li>

<li>
<p>To use the sample data, download <a href="http://lgt.igs.umaryland.edu/twinblast_mauritiana.tgz">the tarball</a> and place 
it in the directory you specified as the prefix in step 4 (/var/www/twinblast/files/). Then unpack the tarball</p>

<pre><code>cp ~/Downloads/twinblast_mauritiana.tgz /var/www/twinblast/files/
cd /var/www/twinblast/files/
tar xzvf twinblast_mauritiana.tgz
</code></pre>
</li>
<li><p>Now load the twinblast web form by entering in the ip address or hostname of your webserver with the url 
of the twinblast.html file (i.e. 192.168.100.1/twinblast/twinblast.html) </p>
<p>When the page loads copy and paste the path to your blast output file into the 'Blast File' box 
(/var/www/twinblast/files/twinblast_mauritiana/SRX135546_UM_all_uniq_filtered.out)</p>

<p>Now change the 'Left ID Suffix' and 'Right ID Suffix' to /1 and /2 respectively. These characters have
  been added to the read names to distinguish between read 1 and read 2.
</p>

<p>Next, copy and paste the path to the list of id's into the 'List of queries' box 
  (/var/www/twinblast/files/twinblast_mauritiana/mauritiana_ids.txt)
</p>

<p>Now click the reload button and wait for your results to be indexed.</p>
</li>

</ol>
        </section>

        <footer>
          TwinBLAST was initially written by <a href="https://github.com/rileydavidr">rileydavidr</a> and is currently maintained by <a href="https://github.com/IGS/twinblast">IGS</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
